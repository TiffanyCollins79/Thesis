\chapter{Diffusive Shock Acceleration} \label{A3_DSA}

At Earth, the energy spectrum of cosmic rays have been measured up to $10^{20}~\eV$ (see \autoref{sec:chapter_1_cr_spectrum}). But how do cosmic rays reach these enormous energies? Fermi, in 1949, proposed a mechanism where cosmic rays are accelerated through the interaction with magnetic field irregularities in ISM gas clouds \citep{1949PhRv...75.1169F}. However, the amount of energy gained through these interactions was relatively small to explain the highest energy cosmic rays observed at Earth. Fermi's original theory was modified in the 1970's to consider the acceleration of cosmic rays as they travel through a shock wave generated by, for example, a SNR \citep{1977DoSSR.234.1306K,1977ICRC...11..132A,1978MNRAS.182..147B,1978MNRAS.182..443B,1978ApJ...221L..29B}. This is known as diffusive shock acceleration.

\section{Fermi's Original Theory}

In Fermi's original theory, a cosmic ray with energy $E_1$  scatters of a ISM gas cloud (travelling at velocity $v_c$ in the lab frame) at angle $\theta_1$ (see \autoref{fig:A3_DSA_fermi_orig_frames}) and exits the cloud with energy $E_2$ and angle $\theta_2$. Using Lorentz transformations, the original energy in the cloud frame (primed frame) is given by:

\begin{figure}
    \centering
    \includegraphics{A3_Diffusive_Shock_Acceleration/Images/fermi_original_theory_frames.png}
    \caption{In the lab frame (\textit{left}), a Cosmic ray with energy $E_1$ enters a ISM cloud (travelling at spped $v_c$) at angle $\theta_1$ and scatters off magnetic field tubulence and exits the cloud with energy $E_2$ and angle $\theta_2$. The same process is shown in the right, but in the reference frame of the cloud (labeled as primed).}
    \label{fig:A3_DSA_fermi_orig_frames}
\end{figure}

\begin{equation}
    \begin{aligned}
        E_1'=\gamma_cE_1\qty(1-\beta_c\cos\theta_1)\text{ ,}
    \end{aligned}
\end{equation}
\noindent where $\beta_c=v_c/c$ and $\gamma_c=1/\sqrt{1-\beta_c^2}$. The scattering is collisionless (elastic) in the reference frame of the cloud, giving $E_1'=E_2'$. The final energy in the lab frame is then:

\begin{equation}
    \begin{aligned}
        E_2&=\gamma_c E_2'\qty(1+\beta_c\cos\theta_2') \\
        &=\gamma_c^2E_1\qty(1+\beta_c\cos\theta_2')\qty(1-\beta_c\cos\theta_1) \text{ .}
    \end{aligned}
\end{equation}
\noindent The cosmic-ray fractional energy gain is then:

\begin{equation}
    \begin{aligned}
        \frac{\Delta E}{E}&=\frac{E_2-E_1}{E_1} \\
        &=\frac{1-\beta_c\cos\theta_1+\beta_c\cos\theta_1+\beta_c^2\cos\theta_1\cos\theta_2'}{E_1\qty(1-\beta_c^2)}-1\text{ .}
    \end{aligned}
\end{equation}
\noindent Considering the average fractional energy gain ($\langle \Delta E/E \rangle$), the outcoing direction of the cosmic ray in the clouds reference frame is randomised, therefore $\langle \cos\theta_2'=0 \rangle$. To calculate the average original cosmic-ray angle, consider the ISM cloud traveling a distance $v_ct$ in a `sea' of cosmic rays travelling at speed $v_\text{CR}$ (see \autoref{fig:A3_fermi_origin_theta1}). In time $t$, all cosmic rays in length $l$ will enter the cloud. For relativistic cosmic rays ($v_\text{cr}>>v_c$):

\begin{equation}
    \begin{aligned}
        L&=t\sqrt{v_\text{CR}^2+v_c^2-2v_\text{CR}v_c\cos\theta_1} \\
        &\approx t\qty(v_\text{CR}-v_c\cos\theta_1) \text{ .}
    \end{aligned}
\end{equation}
\noindent For a spherical cloud of radius $r$ having cross section $\sigma=\pi r^2$, the collision rate, $R$, is:
\begin{wrapfigure}[9]{r}{0.34\textwidth}
    \centering
    \includegraphics[width=0.33\textwidth]{A3_Diffusive_Shock_Acceleration/Images/fermi_original_theta1.png}
    \caption{A ISM cloud travelling at speed $v_c$ in a `sea' of cosmic rays. In time $t$, the cosmic rays in path $L$ with speed $v_\text{CR}$ will enter the cloud.}
    \label{fig:A3_fermi_origin_theta1}
\end{wrapfigure}
\begin{equation}
    \begin{aligned}
        R&=\frac{n_\text{CR}L\sigma}{t} \\
        &=n_\text{CR}\sigma\qty(v_\text{CR}-v_c\cos\theta_1) \text { ,}
    \end{aligned}
\end{equation}
\noindent where $n_\text{CR}$ is the cosmic-ray density. For an isotropic cosmic-ray distribution:

\begin{equation}
    \begin{aligned}
        \dv{n_\text{CR}}{\cos\theta_1}&=\frac{n_\text{CR}}{2}\text{,}\quad -1<\cos\theta_1<1\text{ ,}
    \end{aligned}
\end{equation}
\noindent where $-1<\cos\theta_1<1$ considers all angles of $\theta_1$.

\section{Diffusive Shock Acceleration}

\begin{SCfigure}[0.5][h]
	\centering
	\includegraphics[width=0.7\textwidth]{A3_Diffusive_Shock_Acceleration/Images/shock_dynamics.png}
	\caption{A cosmic ray travels upstream of the shock at velocity $U_1$ (relative to the shock) at angle $\Theta_1$ and `passes` through the shock downstream. The cosmic ray now has velocity $U_2$ at angle $\Theta_2$. $B_1$ and $B_2$ are the magnetic fields upstream and downstream of the shock with angles $\theta_{B1}$ and $\theta_{B2}$ to the normal to the shock respectively.}
	\label{fig:A3_shock_dynamics}
\end{SCfigure}

A cosmic ray travelling upstream of the shock at velocity $U_1$ and angle $\theta_1$ will `pass' through the shock and travel at velocity $U_2$ and angle $\theta_2$ downstream of the shock (see \autoref{fig:A3_shock_dynamics}). The magnetic fields upstream and downstream of the shock are $B_1$ and $B_2$ respectively.  $x$ and $y$ is defined to be the direction perpindicular and parallel to the shock respectively.
%If $\theta_1=\theta_{B1}$ and $\theta_2=\theta_{B2}$ (i.e. the cosmic ray velocity is parallel to the magnetic field) then the shock is parallel. Hence, the electric field in the reference frame of the shock is zero \citep{1983RPPh...46..973D}.
The compression ratio is defined to be the mass density ratio of the shocked and unshocked material:

\begin{equation}
    \begin{aligned}
        r&=\frac{\rho_2}{\rho_1}\text{ ,}
    \end{aligned}
\end{equation}
\noindent where $\rho$ is the density. From conservation of mass:

\begin{equation}
    \begin{aligned}
        \rho_1U_{1x}&=\rho_2U_{2x}=A \\
        \therefore U_{1x}&=rU_{2x}\text{ ,}
    \end{aligned} \label{eq:A3_velocity_ratios}
\end{equation}
\noindent where $A$ is a constant. From conservation of momentum:

\begin{subequations}
    \begin{alignat}{1}
        U_{1y}&=U_{2y} \\
        AU_{1x}&=AU_{2x}+P\text{ ,}
    \end{alignat}
\end{subequations}
\noindent with $P$ being the pressure downstream. From the conservation of energy:

\begin{equation}
    \begin{aligned}
        \frac{1}{2}AU_{1x}^2&=\frac{1}{2}U_{2x}^2+U_{2x}\qty(E+P)\text{ ,}
    \end{aligned}
\end{equation}
\noindent it can be found that the compression ratio can be expressed in terms of the downstream internal energy $E$:

\begin{equation}
    \begin{aligned}
        r&=1+\frac{2E}{P}\text{ ,}
    \end{aligned}
\end{equation}
\noindent and $r$ takes values $4$ and $7$ for monatomic non-relativistic and relativistic gas respectively  \citep{1983RPPh...46..973D}.
\par~\par 
\begin{figure}[h]
	\centering
	\includegraphics[width=1.0\textwidth]{A3_Diffusive_Shock_Acceleration/Images/upstream_downstream.png}
	\caption{In the reference frame of the shock, a cosmic ray travelling upstream of the shock (with velocity $U_1$) to downstream of the shock (now travelling at velocity $U_2)$. $B_1$ and $B_2$ are the magnetic fields upstream and downstream of the shock with angles $\theta_{B1}$ and $\theta_{B2}$ to the normal to the shock respectively.}
	\label{fig:A3_shock_dynamics2}
\end{figure}

In the frame of the shock, the material upstream of the shock travels towards the shock at $U_1=V_s$ (see \autoref{fig:A3_shock_dynamics2}). Hence, the material downstream of the shock in the upstream reference frame (primed frame) travels at speed:

\begin{equation}
    \begin{aligned}
        U_{2x}'&=U_{1x}-U_{2x} =V_s- \frac{V_s}{r} \\
        \therefore \frac{U_{2x}'}{V_s}&=\frac{r-1}{r}\text{ ,}
    \end{aligned} \label{eq:down_upstream_v_ratio}
\end{equation}
\noindent For non-relativistic particles ${U_{2x}'}/{V_s}=3/4$.
\par~\par 
\begin{SCfigure}[0.5][h]
	\centering
	\includegraphics[width=0.65\textwidth]{A3_Diffusive_Shock_Acceleration/Images/dsa.png}
	\caption{In the reference frame of the material upstream of the shock, a cosmic ray of energy $E_1$ travels upstream to downstream with no change of energy. The cosmic ray scatters off magnetic field tubulence in a  cloud downstream of the shock and passes back upstream of the shock . This process can repeat or the cosmic ray can escape the system.}
	\label{fig:A3_shock_dynamics3}
\end{SCfigure}

Now consider the scenario described in \autoref{fig:A3_shock_dynamics3}, where cosmic ray of energy $E_1$ and velocity $v$ crosses upstream to downstream at angle $\theta_1$ (in the upstream reference frame). Lorentz transformations gives the energy of the cosmic ray in the shock reference frame:

\begin{equation}
    \begin{aligned}
        E_1'&=\gamma_d\qty(E_1-\beta_d p_1\cos\theta_1 c)\text{ ,}
    \end{aligned}
\end{equation}
\noindent where $\beta_d=v_d/c$, $v_d$ is the velocity of the cosmic ray downstream, $\gamma_d$ is the Lorentz factor downstream and $p$ is the momentum. The energy and momentum of a cosmic ray is related by $E\approx pc$, therefore:

\begin{equation}
    \begin{aligned}
        E_1'&=\gamma_d E_1\qty(1-\beta_d \cos\theta_1)\text{ .}
    \end{aligned}
\end{equation}

\noindent The cosmic ray then scatters of a downstream cloud and in the reference frame of the cloud $E_2'=E_1'$. The cosmic ray then travels back upstream of the shock with energy:

\begin{equation}
    \begin{aligned}
        E_2&=\gamma_u E_2'\qty(1+\beta\cos\theta_2') \\
        &=\gamma_d\gamma_u E_1 \qty(1-\beta \cos\theta_1)\qty(1+\beta\cos\theta_2')\text{ ,}
    \end{aligned}
\end{equation}

\noindent where $\beta_u=v_u/c$, $v_u$ is the velocity of the cosmic ray upstream and $\gamma_u$ is the Lorentz factor upstream. Assuming the same velocity upstream and downstream ($\beta=\beta_d=\beta_u$ and $\gamma=\gamma_d=\gamma_u$), the fractional energy gain for one back and forth crossing is then:

\begin{equation}
    \begin{aligned}
    \frac{\Delta E}{E}&=\frac{E_2-E_1}{E_1} \\
&=\frac{1-\beta\cos\theta_1+\beta\cos\theta_2'-\beta^2\cos\theta_2'\cos\theta_1}{1-\beta^2}-1\text{ .}
    \end{aligned} 
\end{equation}
\noindent Therefore, the average fractional energy is:

\begin{equation}
    \begin{aligned}
    \expectation{\frac{\Delta E}{E}}
	&=\frac{1-\beta\expectation{\cos\theta_1}+\beta\expectation{\cos\theta_2'}-\beta^2\expectation{\cos\theta_1}\expectation{\cos\theta_2'}}{1-\beta_\text{cloud}^2}-1\text{ .}
    \end{aligned} 
\end{equation}
\noindent The average angle, $\expectation{\cos\theta}$, can be found via:

\begin{equation}
    \begin{aligned}
        \expectation{\cos\theta}&=\frac{\int p\qty(\cos\theta)\cos\theta\sin\theta \dd{\theta}}{\int_\pi^{\pi/2}p\qty(\cos\theta)\sin\theta \dd{\theta}} \\
        &=\frac{\int p\qty(\cos\theta)\cos\theta\dd{\cos\theta}}{p\qty(\cos\theta) \dd{\cos\theta}}
    \end{aligned}
\end{equation}
\noindent where $p\qty(\cos\theta)$ is the probability of a cosmic ray having angle $\theta$. The probability of a cosmic ray travelling upstream to downstream is proportional to the rate of particles per unit area travelling upstream to downstream:

\begin{equation}
    \begin{aligned}
        p\qty(\cos\theta_1)\propto R_{u\rightarrow d}\qty(\theta_1)&\approx-n_{CR}v\cos\theta_1\quad &[\si{\per\meter\squared\per\second}]\text{ ,}
    \end{aligned}
\end{equation}
\noindent and $\ang{90}<\theta_1<\ang{180}$ (see \autoref{fig:A3_shock_dynamics3}) Similarly, the rate of cosmic rays crossing per unit area from downstream to upstream is defined by:

\begin{equation}
    \begin{aligned}
p\qty(\cos\theta_2')\propto R_{d\rightarrow u}\qty(\theta_2')&\approx n_{CR}v\cos\theta_2'\quad&[\si{\per\meter\squared\per\second} ]\text{ ,}
    \end{aligned}
\end{equation}
\noindent with $\ang{0}<\theta_2'<\ang{90}$ (see \autoref{fig:A3_shock_dynamics3}). Therefore:

\begin{equation}
    \begin{aligned}
    \expectation{\cos\theta_1}&=\frac{\int_{-1}^{0} \cos\theta_1^2\dd{\cos\theta_1}}{\int_{-1}^{0}\cos\theta_1 \dd{\cos\theta_1}}=-\frac{2}{3} \\
    \expectation{\cos\theta_2'}&=\frac{\int_{0}^{1} {\cos\theta_2'}^2\dd{\cos\theta_2'}}{\int_{0}^{1}\cos\theta_2' \dd{\cos\theta_2'}}=\frac{2}{3}\text{ .}
    \end{aligned} 
\end{equation}
\noindent Giving the average fractional energy gain:

\begin{equation}
    \begin{aligned}
    \expectation{\frac{\Delta E}{E}}
	&=\frac{\beta^2+\frac{4}{3}\beta+\frac{4}{9}\beta^2}{1-\beta_\text{cloud}^2}\text{ .}
    \end{aligned} 
\end{equation}
\noindent For a non-relativistic particle ($\beta\ll 1$) and $R=4$ (see \autoref{eq:down_upstream_v_ratio}):

\begin{equation}
    \begin{aligned}
    \expectation{\frac{\Delta E}{E}}
	&\approx \frac{4}{3}\beta =\frac{4}{3}U_2'  \\
    &=\frac{4}{3}\qty(\frac{R-1}{R})\frac{V_s}{c} \\
    &\approx \frac{V_s}{c}\text{ .}
    \end{aligned} 
\end{equation}

Each time the cosmic ray travels back and across the shock, the cosmic ray has increased its energy by a factor $V_s/c$.